<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Panel de Control VNF & SDN</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <style>
    body { font-family: 'Poppins', sans-serif; }
    #mapa-topologia {
    height: 600px;
    }

  </style>
</head>
<body class="bg-gray-50">
  <header class="fixed w-full bg-white/80 backdrop-blur border-b border-gray-200 shadow-md z-50 transition-all">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex items-center justify-between h-16">
      <a href="#dashboard" class="text-2xl font-bold text-blue-600 tracking-tight hover:text-blue-700 transition">VNF & SDN</a>
      <nav class="space-x-6 hidden md:flex text-sm font-medium">
        <a href="#dashboard" class="text-gray-700 hover:text-blue-700">Dashboard</a>
        <a href="#topology" class="text-gray-700 hover:text-blue-700">Topología</a>
        <a href="#config" class="text-gray-700 hover:text-blue-700">Configuración</a>
        <a href="#stats" class="text-gray-700 hover:text-blue-700">Estadísticas & Logs</a>
        <a href="#docs" class="text-gray-700 hover:text-blue-700">Ayuda / Documentación</a>
        <a href="/sdn-manager" target="_blank" class="text-gray-700 hover:text-blue-700">
            Abrir Gestor SDN en pestaña nueva
        </a>
        
      </nav>
      <button class="md:hidden bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold py-2 px-4 rounded-lg shadow-sm transition-all" id="menu-btn" aria-label="Menú">☰</button>
    </div>


  </header>

  <main class="pt-20 max-w-7xl mx-auto px-4 space-y-16">



    <section id="dashboard" class="bg-white border-t-4 border-blue-600 pt-12 pb-12 rounded-xl shadow-sm">
      <h2 class="text-2xl font-semibold text-blue-600 mb-4">Dashboard</h2>
      <div class="grid lg:grid-cols-3 gap-8">
        <div class="bg-gradient-to-br from-white to-gray-50 rounded-xl shadow-lg p-6 hover:shadow-xl transition-all">
          <h3 class="text-xl font-semibold mb-2 text-blue-600">Resumen del Estado</h3>
          <p class="text-gray-700">
            Servidores VLC activos: <span id="vlc-activos" class="font-bold text-blue-600">0</span> /
            Inactivos: <span id="vlc-inactivos" class="font-bold">0</span>
          </p>          
          <p class="text-gray-700">Algoritmos: Balanceo <span class="font-semibold">Round-Robin</span>, Enrutamiento <span class="font-semibold">Dijkstra</span></p>
        </div>
        <div class="bg-gradient-to-br from-white to-gray-50 rounded-xl shadow-lg p-6 hover:shadow-xl transition-all">
          <h3 class="text-xl font-semibold mb-2 text-blue-600">Indicadores Clave</h3>
          <p class="text-gray-700">Total de peticiones procesadas: <span class="font-bold text-blue-600">15,742</span></p>
          <div class="h-32 bg-gray-100 rounded-lg flex items-center justify-center text-gray-700">[Gráfico Distribución de Carga]</div>
        </div>
        <div class="bg-white rounded-2xl shadow p-6">
          <h3 class="text-xl font-semibold mb-2 text-blue-600">Alertas Recientes</h3>
          <ul class="list-disc list-inside text-gray-700 space-y-1">
            <li class="text-red-600">Enlace S1-S2: Caído (05-11-2025 10:32)</li>
            <li class="text-red-600">VLC-03 inactivo (05-11-2025 09:45)</li>
          </ul>
        </div>
      </div>
      <div class="mt-10 bg-gradient-to-br from-white to-gray-50 rounded-xl shadow-lg p-6 hover:shadow-xl transition-all">
        <h3 class="text-lg font-semibold mb-2 text-blue-600">Actividad Reciente</h3>
        <div class="max-h-40 overflow-auto">
          <ul class="text-gray-700 list-disc list-inside space-y-1">
            <li>05-11-2025 11:15: Petición de video al servidor VLC-02</li>
            <li>05-11-2025 11:10: Switch S5 reconfigurado</li>
            <li>05-11-2025 11:05: Usuario admin cambió algoritmo a Weighted RR</li>
          </ul>
        </div>
      </div>
    </section>

    <section id="topology" class="bg-white border-t-4 border-blue-600 pt-12 pb-12 rounded-xl shadow-sm">
      <h2 class="text-2xl font-semibold text-blue-600 mb-4">Topología en Mapa</h2>
      <div class="bg-white rounded-xl p-4 shadow grid md:grid-cols-4 gap-6">
        <div class="md:col-span-3">
          <div id="mapa-topologia" class="rounded-xl border"></div>
        </div>
        <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
          <h3 class="font-semibold mb-2 text-blue-600">Controles</h3>
          <button onclick="map.zoomIn()" class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium py-2 px-4 rounded-lg transition mb-2 w-full">Zoom In</button>
          <button onclick="map.zoomOut()" class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium py-2 px-4 rounded-lg transition mb-2 w-full">Zoom Out</button>
          <button onclick="map.setView([54.5, 15.3], 4)" class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium py-2 px-4 rounded-lg transition mb-2 w-full">Reset Vista</button>
          <p class="mt-4 text-gray-700">Haz clic en nodo/enlace para más acciones.</p>
        </div>
        <div class="mt-6 bg-white border border-gray-200 rounded-lg p-4 shadow-sm col-span-4">
            <h3 class="text-blue-600 font-semibold mb-2">Enlaces actuales</h3>
            <div class="overflow-y-auto max-h-64 w-full">
                <table class="min-w-full table-auto text-left text-sm border border-gray-300 rounded overflow-hidden">
                <thead class="bg-blue-100 sticky top-0 text-gray-700">
                    <tr>
                    <th class="p-3 border border-gray-300">Origen</th>
                    <th class="p-3 border border-gray-300">Destino</th>
                    <th class="p-3 border border-gray-300">Ancho Banda</th>
                    <th class="p-3 border border-gray-300">Acción</th>
                    </tr>
                </thead>
                <tbody id="tabla-enlaces" class="bg-white">
                    <!-- Se llena dinámicamente desde JS -->
                </tbody>
                </table>
            </div>
              
          </div>
          <div class="mt-6 bg-white border border-gray-200 rounded-lg p-4 shadow-sm col-span-4">
            <h3 class="text-blue-600 font-semibold mb-2">Crear nuevo enlace</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
              <select id="select-origen" class="border-gray-300 rounded p-2">
                <option disabled selected>Switch origen</option>
              </select>
              <select id="select-destino" class="border-gray-300 rounded p-2">
                <option disabled selected>Switch destino</option>
              </select>
              <input id="input-bw" type="number" min="1" placeholder="Ancho de banda (Mbps)" class="border-gray-300 rounded p-2">
            </div>
            <button onclick="crearEnlace()" class="mt-4 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded shadow-md transition">
              Crear Enlace
            </button>
          </div>
      </div>
    </section>

    <section id="config" class="bg-white border-t-4 border-blue-600 pt-12 pb-12 rounded-xl shadow-sm">
      <h2 class="text-2xl font-semibold text-blue-600 mb-4">Configuración</h2>
      <div class="bg-gradient-to-br from-white to-gray-50 rounded-xl shadow-lg p-6 space-y-6 hover:shadow-xl transition-all">
        <div>
          <h3 class="text-lg font-semibold mb-2 text-blue-600">Selección de Algoritmos</h3>
          <div class="grid md:grid-cols-2 gap-4">
            <div>
              <label class="block mb-1 font-medium text-gray-700">Balanceo de Carga</label>
              <div class="flex items-center gap-2"> <select id="load-balancing-algo" class="w-full border-gray-300 rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-blue-400">
                  <option value="Round-Robin">Round-Robin</option>
                  <option value="Weighted Round-Robin">Weighted Round-Robin</option>
                </select>
                <button onclick="saveLoadBalancingAlgorithm()" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition">Guardar</button>
              </div>
            </div>
            <div>
              <label class="block mb-1 font-medium text-gray-700">Enrutamiento</label>
              <div class="flex items-center gap-2"> <select id="routing-algo" class="w-full border-gray-300 rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-blue-400">
                  <option value="Shortest Path">Shortest Path</option>
                  <option value="Dijkstra (ancho de banda)">Dijkstra (ancho de banda)</option>
                </select>
                <button onclick="saveRoutingAlgorithm()" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition">Guardar</button>
              </div>
            </div>
          </div>
        </div>
        <div>
          <h3 class="text-lg font-semibold mb-2 text-blue-600">Pesos (Weighted Round-Robin)</h3>
          <div class="overflow-auto rounded-lg border border-gray-200">
            <table class="w-full text-left border-collapse text-sm">
              <thead class="bg-blue-100">
                <tr>
                  <th class="p-2 text-gray-700">Servidor</th>
                  <th class="p-2 text-gray-700">Peso</th>
                </tr>
              </thead>
              <tbody>
                <tr><td class="p-2">VLC-01</td><td class="p-2"><input type="number" class="w-full border-gray-300 rounded p-1 focus:outline-none focus:ring-2 focus:ring-blue-400" value="1" data-server="VLC-01"></td></tr>
                <tr><td class="p-2">VLC-02</td><td class="p-2"><input type="number" class="w-full border-gray-300 rounded p-1 focus:outline-none focus:ring-2 focus:ring-blue-400" value="1" data-server="VLC-02"></td></tr>
                <tr><td class="p-2">VLC-03</td><td class="p-2"><input type="number" class="w-full border-gray-300 rounded p-1 focus:outline-none focus:ring-2 focus:ring-blue-400" value="1" data-server="VLC-03"></td></tr>
                <tr><td class="p-2">VLC-04</td><td class="p-2"><input type="number" class="w-full border-gray-300 rounded p-1 focus:outline-none focus:ring-2 focus:ring-blue-400" value="0" data-server="VLC-04"></td></tr>
              </tbody>
            </table>
          </div>
          <button onclick="saveWeightedRoundRobinWeights()" class="mt-4 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition">Guardar Pesos</button>
        </div>
          
        <div class="flex flex-col md:flex-row items-start md:items-center justify-between gap-4">
          <div>
            <h3 class="font-semibold mb-1 text-blue-600">Historial de Configuraciones</h3>
            <ul class="text-gray-700 list-disc list-inside max-h-32 overflow-auto text-sm">
              <li>05-11-2025 08:00: Round-Robin / Shortest Path</li>
              <li>05-10-2025 14:30: Weighted RR / Dijkstra</li>
              <li>05-09-2025 18:20: Round-Robin / Dijkstra</li>
              <li>05-08-2025 12:05: Weighted RR / Shortest Path</li>
            </ul>
          </div>
        </div>
      </div>
      <div class="mt-6 bg-white border border-gray-200 rounded-lg p-4 shadow-sm col-span-4">
        <h3 class="text-blue-600 font-semibold mb-2">Gestión de Servidores de Video</h3>
        
        <div class="grid md:grid-cols-2 gap-6">
          <!-- Panel de Asignación -->
          <div>
            <h4 class="font-medium mb-2">Asignar Nuevo Servidor</h4>
            <div class="space-y-4">
              <div>
                <label class="block text-sm font-medium mb-1">Hosts Disponibles</label>
                <select id="host-select" multiple class="border border-gray-300 rounded p-2 w-full h-32">
                  <!-- Se llenará dinámicamente -->
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium mb-1">Ruta del Video</label>
                <input type="text" id="video-path" placeholder="/videos/ejemplo.mp4" 
                       class="border border-gray-300 rounded p-2 w-full">
              </div>
              <button onclick="startVideoServer()" 
                      class="bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded shadow-md transition">
                Iniciar Servidor
              </button>
            </div>
          </div>
          
          <!-- Lista de Servidores Activos -->
          <div>
            <h4 class="font-medium mb-2">Servidores Activos</h4>
            <div class="overflow-auto rounded-lg border border-gray-200">
              <table class="w-full text-sm">
                <thead class="bg-gray-100">
                  <tr>
                    <th class="p-2 text-left">Host</th>
                    <th class="p-2 text-left">Video</th>
                    <th class="p-2 text-left">Estado</th>
                    <th class="p-2 text-left">Acciones</th>
                  </tr>
                </thead>
                <tbody id="active-servers-table">
                  <!-- Se llenará dinámicamente -->
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Modal para Cambiar Video -->
      <div id="change-video-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 max-w-md w-full">
          <h3 class="text-lg font-semibold mb-4">Cambiar Video</h3>
          <input type="text" id="new-video-path" placeholder="Nueva ruta del video" 
                 class="w-full border p-2 rounded mb-4">
          <div class="flex justify-end space-x-3">
            <button onclick="closeModal()" class="px-4 py-2 border rounded">Cancelar</button>
            <button onclick="confirmVideoChange()" class="px-4 py-2 bg-blue-600 text-white rounded">Aplicar</button>
          </div>
        </div>
      </div>
      
    </section>

    <section id="stats" class="bg-white border-t-4 border-blue-600 pt-12 pb-12 rounded-xl shadow-sm">
      <h2 class="text-2xl font-semibold text-blue-600 mb-4">Estadísticas y Logs</h2>
      <div class="grid lg:grid-cols-2 gap-6">
        <div class="bg-white rounded-2xl shadow p-6">
          <h3 class="text-xl font-semibold mb-4 text-blue-600">Estadísticas de Uso</h3>
          <div class="h-48 bg-gray-100 rounded-lg mb-4 flex items-center justify-center text-gray-700">[Gráfica de Peticiones]</div>
          <p class="text-gray-700 mb-2">Tasa de peticiones por minuto: <span class="font-bold text-blue-600">120</span></p>
          <div class="overflow-auto">
            <table class="w-full text-left border-collapse text-sm">
              <thead>
                <tr class="bg-gray-100">
                  <th class="p-2 text-gray-700">Tipo</th>
                  <th class="p-2 text-gray-700">Cantidad</th>
                </tr>
              </thead>
              <tbody id="tabla-estadisticas">
                <!-- Datos dinámicos -->
              </tbody>
            </table>
          </div>
        </div>
        <div class="bg-white rounded-2xl shadow p-6">
          <h3 class="text-xl font-semibold mb-4 text-blue-600">Registro de Eventos (Logs)</h3>
          <div class="flex flex-col md:flex-row md:items-center gap-2 mb-4">
            <input type="text" placeholder="Buscar host/tipo..." class="flex-1 border-gray-300 rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-blue-400">
            <input type="date" class="border-gray-300 rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-blue-400">
            <button class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium py-2 px-4 rounded-lg transition">Exportar CSV</button>
          </div>
          <ul id="lista-logs" class="space-y-2 text-gray-700 max-h-64 overflow-auto text-sm">
            <!-- Datos dinámicos -->
          </ul>
        </div>
      </div>
    </section>

    <section id="db" class="bg-white border-t-4 border-blue-600 pt-12 pb-12 rounded-xl shadow-sm">
      <h2 class="text-2xl font-semibold text-blue-600 mb-4">Módulo de Base de Datos</h2>
      <div class="bg-gradient-to-br from-white to-gray-50 rounded-xl shadow-lg p-6 space-y-4 hover:shadow-xl transition-all">
        <div class="flex items-center justify-between">
          <div class="flex items-center gap-2">
            <span class="h-3 w-3 rounded-full bg-green-500"></span>
            <p class="text-gray-700">Conexión a PostgreSQL activa</p>
          </div>
          <p class="font-bold text-blue-600">Latencia: 12ms</p>
        </div>
        <div class="flex gap-4">
          <button class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium py-2 px-4 rounded-lg transition">Exportar Esquema</button>
          <button class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium py-2 px-4 rounded-lg transition">Restablecer Datos de Prueba</button>
        </div>
      </div>
    </section>

    <section id="docs" class="bg-white border-t-4 border-blue-600 pt-12 pb-12 rounded-xl shadow-sm">
      <h2 class="text-2xl font-semibold text-blue-600 mb-4">Ayuda / Documentación</h2>
      <div class="bg-gradient-to-br from-white to-gray-50 rounded-xl shadow-lg p-6 space-y-4 hover:shadow-xl transition-all">
        <p class="text-gray-700">Consulta la <a href="#" class="underline hover:text-blue-700">documentación completa</a> o utiliza nuestros recursos:</p>
        <ul class="list-disc list-inside text-gray-700">
          <li><a href="#" class="hover:text-blue-700">Guía rápida de inicio</a></li>
          <li><a href="#" class="hover:text-blue-700">Tutorial de integración API</a></li>
          <li><a href="#" class="hover:text-blue-700">FAQs</a></li>
        </ul>
      </div>
    </section>

  </main>

  <footer class="py-6 bg-blue-600 text-white text-center">
    <p>&copy; 2025 Megas Comunicaciones. Todos los derechos reservados.</p>
  </footer>

  <script src="/static/js/index.js"></script>
  <script src="/static/js/servers.js"></script>
</body>
</html>
